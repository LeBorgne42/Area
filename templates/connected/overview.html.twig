{% extends 'base.html.twig' %}

{% trans_default_domain 'front_overview' %}

{% block title %}{{ 'title'|trans }}{% endblock %}

{% block body %}
    {% set cost = (app.user.getAllSoldier() * 2) + app.user.getAllShipsCost() + app.user.getBuildingCost() %}
    <div class="front-block">
        <table class="table table-striped table-bordered table-dark">
            <tbody>
            <tr>
                <th class="tab-cells-name">
                    <h3 class="float-left mt-1">{{ 'title.tmpbeta'|trans|raw }}</h3>
                </th>
            </tr>
            </tbody>
        </table>
        <table class="table table-striped table-dark text-center borderOverview">
            <tbody>
                <tr>
                    <th class="tab-cells-name pt-4">
                        <div class="modify">
                            {% if app.user %}
                                {% if app.user.imageName %}
                                    <img data-toggle="tooltip" data-placement="top" title="{{ 'tooltip.modify'|trans }}" height="64" width="64" src="{{ vich_uploader_asset(app.user, 'imageFile') }}">
                                {% else %}
                                    <img data-toggle="tooltip" data-placement="top" title="{{ 'tooltip.modify'|trans }}" height="64" width="64" src="{{ asset('img/avatar.png') }}">
                                {% endif %}
                            {% else %}
                                <img data-toggle="tooltip" data-placement="top" title="{{ 'tooltip.modify'|trans }}" height="64" width="64" src="{{ asset('img/avatar.png') }}">
                            {% endif %}
                            <div><strong>{{ 'modify'|trans }}</strong></div>
                        </div>
                        {{ form_start(form_image,{attr: { hidden: 'hidden'}}) }}
                        {{ form_widget(form_image.imageFile) }}
                        {{ form_widget(form_image.sendForm) }}
                        {{ form_end(form_image) }}
                    </th>
                    <td class="center-cells text-left">
                        <div class="my-2">{{ 'info.userName'|trans|raw }} <span><a data-toggle="modal" data-target="#userModal" href="{{ path('user_profil_modal', {'idp': usePlanet.getId(), 'id': app.user.getId()}) }}">{{ app.user.getUsername() }}</a></span></div>
                        {#<div class="my-2">{{ 'info.grade'|trans|raw }} {% if app.user.getAlly() %}{{ app.user.getGrade().getName() }}{% else %}{{ 'info.independant'|trans|raw }}{% endif %}</div>#}
                        <div class="my-2">{{ 'info.rank'|trans|raw }} {{ app.user.getRank().getPosition()|number_format }} |  {% if app.user.getRank().getPoint() > app.user.getRank().getOldPoint() %}<span class="text-vert">+{{ (app.user.getRank().getPoint() - app.user.getRank().getOldPoint())|number_format }}</span>{% else %}<span class="text-rouge">-{{ (app.user.getRank().getOldPoint() - app.user.getRank().getPoint())|number_format }}</span>{% endif %}  ({% if app.user.getRank().getPosition() > app.user.getRank().getOldPosition() %}<span class="text-rouge">-{{ app.user.getRank().getPosition() - app.user.getRank().getOldPosition() }}</span>{% else %}<span class="text-vert">+{{ app.user.getRank().getOldPosition() - app.user.getRank().getPosition() }}</span>{% endif %}) <span class="glyphicon glyphicon-question-sign text-orange" data-toggle="tooltip" data-placement="top" title="{{ 'tooltip.rank'|trans }}"></span></div>
                        {% if app.user.getRank().getWarPoint() > 0 %}<div class="my-2">{{ 'info.warPoint'|trans|raw }} <span><a href="{{ path('rank_user', {'idp': usePlanet.getId()}) }}">{{ app.user.getRank().getWarPoint()|number_format }} <img src="{{ asset('img/pdg.png') }}"></a></span></div>{% else %}<span><a target="_blank" href="http://area-control.forumactif.com/t82-point-de-guerre">{{ 'info.warPoint'|trans|raw }} 0</a></span>{% endif %}
                        <div class="my-2">{{ 'info.planet'|trans|raw }} {{ app.user.getColPlanets() }} / {{ app.user.getTerraformation() + 2 }}</div>
                        <div class="my-2">{{ 'info.ship'|trans|raw }} {{ app.user.getAllShips()|number_format }}</div>
                    </td>
                    <td class="center-cells text-left">
                        <div class="my-2">{{ 'info.niobium'|trans|raw }} {{ app.user.getAllNiobium()|number_format }} <img height="10" src="{{ asset('img/niobium.png') }}"></div>
                        <div class="my-2">{{ 'info.water'|trans|raw }} {{ app.user.getAllWater()|number_format }} <img height="10" src="{{ asset('img/water.png') }}"></div>
                        <div class="my-2">{{ 'info.worker'|trans|raw }} {{ app.user.getAllWorker()|number_format }} <img height="10" src="{{ asset('img/worker.png') }}"></div>
                        <div class="my-2">{{ 'info.scientist'|trans|raw }} {{ app.user.getAllScientist()|number_format }} <img height="10" src="{{ asset('img/scientist.png') }}"></div>
                        <div class="my-2">{{ 'info.soldier'|trans|raw }} {{ app.user.getAllSoldier()|number_format }} <img height="10" src="{{ asset('img/soldier.png') }}"></div>
                    </td>
                    <td class="center-cells text-left">
                        {% if app.user.getAlly() %}
                            <div class="my-2">{{ 'info.ally'|trans|raw }} [{{ app.user.getAlly().getSigle() }}] {{ app.user.getAlly().getName() }}</div>
                            <div class="my-2">{{ 'info.allyMembers'|trans|raw }} {{ app.user.getAlly().getUsers()|length }} / 6</div>
                            <div class="my-2">{{ 'info.allyPlanets'|trans|raw }} {{ app.user.getAlly().getPlanets()|number_format }}</div>
                            <div class="my-2">{{ 'info.allyBitcoin'|trans|raw }} {{ app.user.getAlly().getBitcoin()|number_format }}</div>
                            <div class="my-2">{{ 'info.allyShips'|trans|raw }} {{ app.user.getAlly().getAllShips()|number_format }}</div>
                        {% else %}
                            <div class="my-2"><span><a href="{{ path('ally', {'idp': usePlanet.getId()}) }}">{{ 'info.allyMissing'|trans|raw }}</a></span></div>
                        {% endif %}
                    </td>
                </tr>
            </tbody>
        </table>
    {% if fleetMove %}
        <table class="table table-striped table-bordered table-dark text-center">
            <tbody>
            <tr>
                <th class="tab-cells-name p-2">
                    {{ 'overview.fleetName'|trans }}
                </th>
                <th class="tab-cells-name p-2">
                    {{ 'overview.from'|trans }}
                </th>
                <th class="tab-cells-name p-2">
                    {{ 'overview.goTo'|trans }}
                </th>
                <th class="tab-cells-name p-2">
                    {{ 'overview.time'|trans }}
                </th>
                <th class="tab-cells-name p-2">
                    {{ 'overview.fleetSignature'|trans }}
                </th>
            </tr>
            {% for fleet in fleetMove %}
                <tr>
                    <th class="tab-cells-name p-2">
                        <span class="{{ fleet.getPlanet().getFleetsColor(app.user) }}">"{{  fleet.getName() }}" - <a data-toggle="modal" data-target="#userModal" href="{{ path('user_profil_modal', {'idp': usePlanet.getId(), 'id': fleet.getUser().getId()}) }}">{{ fleet.getUser().getUserName() }}</a></span>
                    </th>
                    <td class="center-cells p-2">
                        {% if app.user.getWhereRadar(fleet.getPlanet().getSector().getPosition()) or fleet.getUser() == app.user %}<span><a href="{{ path('map', {id: fleet.getPlanet().getSector.getPosition(), 'idp': usePlanet.getId()}) }}">{{ fleet.getplanet().getName() }} - {{ fleet.getPlanet().getSector().getGalaxy.getPosition() }}:{{ fleet.getPlanet().getSector.getPosition() }}:{{ fleet.getPlanet().getPosition() }}</a></span>{% else %}???{% endif %}
                    </td>
                    <td class="center-cells p-2">
                        <span><a href="{{ path('map', {id: fleet.getSector().getPosition(), 'idp': usePlanet.getId()}) }}">{{ fleet.getSector().getGalaxy.getPosition() }}:{{ fleet.getSector.getPosition() }}:{{ fleet.getPlanete() }}</a></span>
                    </td>
                    <td class="center-cells p-2">
                        <span class="timerArea" hidden>{{ fleet.getFlightTime()|date('Y/m/d H:i:s') }}</span>
                    </td>
                    <td class="center-cells p-2">
                        {{ fleet.getNbrSignatures()|number_format }}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% endif %}
        <table class="table table-striped borderOverview table-dark text-left">
            <tbody>
            <tr>
                <th class="tab-cells-name p-1">
                    <div class="row">
                        <div class="col-6 pt-1">
                            {{ 'overview.search'|trans }}
                            {% if app.user.getSearch() %}<span><a href="{{ path('search', {'idp': usePlanet.getId()}) }}">{{ app.user.getSearch()|trans }}</a></span> (<span class="timerArea" hidden>{{ app.user.getSearchAt()|date('Y/m/d H:i:s') }}</span>) - <a class="text-rouge" href="{{ path('research_cancel', {'idp': usePlanet.getId()}) }}">X</a>{% else %}<span><a href="{{ path('search', {'idp': usePlanet.getId()}) }}">{{ 'cell.searchNone'|trans|raw }}</a></span>{% endif %}
                        </div>
                        <div class="col-6 pt-1"  data-html="true" data-toggle="tooltip" data-placement="top" title="{{ 'tooltip.dailyCost'|trans({'%soldier%': (app.user.getAllSoldier() * 2)|number_format, '%ship%': app.user.getAllShipsCost()|number_format, '%build%': app.user.getBuildingCost()|number_format, '%bitcoin%': (app.user.getAllWorker() / 1.60)|number_format}) }}">
                            {{ 'info.cost'|trans|raw }} {{ cost|number_format }} <img src="{{ asset('img/coin.png') }}">
                        </div>
                    </div>
                </th>
            </tr>
            </tbody>
        </table>
        <div class="row">
            <div class="col-6">
                <table class="table table-striped borderOverview table-dark text-left">
                    <tbody>
                    <tr>
                        <th class="tab-cells-name p-2">
                            {{ 'overview.batiment'|trans }}
                        </th>
                    </tr>
                    {% for planet in app.user.getPlanets() %}
                        {% if planet.getSky() != planet.getSkyPlace() or planet.getGround() != planet.getGroundPlace() %}
                            <tr>
                                <th class="tab-cells-name p-2">
                                    {{ planet.getName() }} : {% if planet.getConstruct() %}<span><a href="{{ path('building', {'idp': planet.getId()}) }}">{{ planet.getConstruct()|trans }}</a></span> (<span class="timerArea" hidden>{{ planet.getConstructAt()|date('Y/m/d H:i:s') }}</span>) - <a class="text-rouge" href="{{ path('cancel_construction', {'idp': usePlanet.getId(), 'id': planet.getId()}) }}">X</a>{% else %}<span><a href="{{ path('building', {'idp': planet.getId()}) }}">{{ 'cell.buildingNone'|trans|raw }}</a></span>{% endif %}
                                </th>
                            </tr>
                        {% endif %}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="col-6">
                <table class="table table-striped borderOverview table-dark text-left">
                    <tbody>
                    <tr>
                        <th class="tab-cells-name p-2">
                            {{ 'overview.spatial'|trans }}
                        </th>
                    </tr>
                    {% for planet in app.user.getPlanets() %}
                        {% if planet.getSpaceShip() %}
                            <tr>
                                <th class="tab-cells-name p-2">
                                    {{ planet.getName() }} : {% if planet.getProduct() %}<span><a href="{{ path('spatial', {'idp': planet.getId()}) }}">{{ 'overview.inProduct'|trans }}</a></span>(<span class="timerArea" hidden>{{ planet.getProduct().getProductAt()|date('Y/m/d H:i:s') }}</span>){% else %}<span><a href="{{ path('spatial', {'idp': planet.getId()}) }}">{{ 'cell.spatialNone'|trans|raw }}</a></span>{% endif %}
                                </th>
                            </tr>
                        {% endif %}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="modal fade" id="userModal" tabindex="-1" role="dialog" aria-labelledby="userModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
            <div class="modal-content special">
            </div>
        </div>
    </div>
{% endblock %}
