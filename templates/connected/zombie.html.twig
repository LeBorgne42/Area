{% extends 'base.html.twig' %}

{% trans_default_domain 'front_zombie' %}

{% block title %}{{ 'title'|trans }}{% endblock %}

{% block body %}
    {% for message in app.flashes('fail') %}
        <div class="flash-notice mt-5 alerte-flash-error text-center">
            {{ message }}
        </div>
    {% endfor %}
    <div class="front-block">
        {% if app.user.getTutorial() == 52 or app.user.getTutorial() == 53 %}
            <table class="table table-striped borderOverview tutorial">
                <tbody>
                <tr>
                    <th class="tab-cells-name p-3 tutorial">
                        <div class="row">
                            <div class="col-12 py-1">
                                {% if app.user.getTutorial() == 52 %}{{ 'zombie.tutorial'|trans|raw }}{% elseif app.user.getTutorial() == 53 %}{{ 'zombie.tutorialBis'|trans|raw }}{% endif %}
                            </div>
                        </div>
                    </th>
                </tr>
                </tbody>
            </table>
        {% endif %}
        <div class="front-block-second text-center">
            <img class="float-left" src="{{ asset('img/zombie_indic.gif') }}">
            <img class="float-right mt-4" src="{{ vich_uploader_asset(planet, 'imageFile') }}">
            <div class="text-more mt-5">{{ 'zombie.planet'|trans }} «{{ planet.getName() }}» <span><a href="{{ path('map', {'sector': planet.getSector().getId(), 'gal': planet.getSector().getGalaxy().getId(), 'usePlanet': planet.getId()}) }}">{{ planet.getSector().getGalaxy.getPosition() }}:{{ planet.getSector().getPosition() }}:{{ planet.getPosition() }}</a></span> {{ 'zombie.infected'|trans }}</div>
            <div class="text-more">{{ 'zombie.menace'|trans }} <span class="zombieIndicator text-rouge">{{ app.user.getZombieAtt() }}</span></div>
            <div class="text-more">{{ 'zombie.available.defense'|trans }} {{ planet.getSoldier() }}/{{ planet.getSoldierMax() }} <img class="mr-3" src="{{ asset('img/soldier.png') }}"> {{ planet.getTank() }}/500 <img class="mr-3" src="{{ asset('img/tanks.png') }}"></div>
            <div class="text-more mb-3">{{ 'zombie.attack'|trans }} <span class="mt-5 timerArea text-rouge" hidden>{% if app.user.getZombieAt() %}{{ app.user.getZombieAt()|date('Y/m/d H:i:s') }}{% endif %}</span></div>
        </div>
        <div class="front-block-game mt-4">
            {% if app.user.getStats()|length > 7 %}
                {% set points = [] %}
                {% set otherZombie = [] %}
                {% set date = [] %}
                {% for otherPoint in otherPoints %}
                    {% set otherZombie = otherZombie|merge([(otherPoint['allZombie'] / otherPoint['numbers'])|round]) %}
                {% endfor %}
                {% for stat in app.user.getStats() %}
                    {% set points = points|merge([stat.getZombie()|round]) %}
                    {% set date = date|merge([stat.getDate()|date("m/d/Y")]) %}
                {% endfor %}
                <div id="zombiePoints" data-zombie-points="{{ points|json_encode }}"></div>
                <div id="zombieOtherPoints" data-zombie-other-points="{{ otherZombie|json_encode }}"></div>
                <div id="zombieDate" data-zombie-date="{{ date|json_encode }}"></div>
                <canvas class="mb-5" id="zombieChart" height="100"></canvas>
                <script src="{{ asset('build/zombieCharts.js') }}"></script>
            {% endif %}
            <h2 class="text-center mb-3">{{ 'zombie.mission'|trans }}</h2>
            <div class="text-center mb-4">{{ 'zombie.speech'|trans }}</div>
            <div class="row">
                <div class="col-6">
                    {{ form_start(form_missionZombie) }}
                    <table class="table table-striped table-bordered table-dark text-center zbMission">
                        <tbody>
                        <tr>
                            <th colspan="5" class="tab-cells-name">
                                <span data-toggle="tooltip" data-placement="top" title="{{ 'tooltip.zombie'|trans }}">{{ 'zombie.zombie'|trans }} <span class="glyphicon glyphicon-question-sign text-orange"></span></span>
                            </th>
                        </tr>
                        <tr>
                            <th class="tab-cells-name">
                                {{ 'zombie.soldier'|trans }}
                            </th>
                            <th class="tab-cells-name">
                                {{ 'zombie.tank'|trans }}
                            </th>
                            <th class="tab-cells-name">
                                {{ 'zombie.time'|trans }}
                            </th>
                            <th width="55" class="tab-cells-name">
                                {{ 'zombie.gain'|trans }}
                            </th>
                            <th class="tab-cells-name">
                                {{ 'zombie.succed'|trans }}
                            </th>
                        </tr>
                        <tr>
                            {% if app.user.getZombieAtt() > -20 %}
                                <td class="center-cells">
                                    {{ form_widget(form_missionZombie.soldier,{attr: { max: planet.getSoldier()}}) }}
                                </td>
                                <td class="center-cells">
                                    {{ form_widget(form_missionZombie.tank,{attr: { max: planet.getTank()}}) }}
                                </td>
                                <td class="center-cells">
                                    {{ form_widget(form_missionZombie.time) }}
                                </td>
                                <td class="center-cells text-center">
                                    <span class="zombieGain">0</span> <img width="12" src="{{ asset('img/zombie_indic.gif') }}">
                                </td>
                                <td class="center-cells text-center">
                                    <span class="zombiePercent">0%</span>
                                </td>
                            {% else %}
                                <td class="center-cells">
                                    {{ form_widget(form_missionZombie.soldier,{attr: { disabled: 'disabled'}}) }}
                                </td>
                                <td class="center-cells">
                                    {{ form_widget(form_missionZombie.tank,{attr: { disabled: 'disabled' }}) }}
                                </td>
                                <td class="center-cells">
                                    {{ form_widget(form_missionZombie.time,{attr: { disabled: 'disabled' }}) }}
                                </td>
                                <td class="center-cells text-center">
                                    <span class="zombieGain">0</span> <img width="12" src="{{ asset('img/zombie_indic.gif') }}">
                                </td>
                                <td class="center-cells text-center">
                                    <span class="zombiePercent">0%</span>
                                </td>
                            {% endif %}
                        </tr>
                        </tbody>
                    </table>
                    {% if app.user.getZombieAtt() > -20 %}
                        {{ form_widget(form_missionZombie.sendForm) }}
                    {% else %}
                        {{ form_widget(form_missionZombie.sendForm,{attr: { disabled: 'disabled' }}) }}
                    {% endif %}
                    {{ form_end(form_missionZombie) }}
                </div>
                <div class="col-6">
                    {{ form_start(form_missionUranium) }}
                    <table class="table table-striped table-bordered table-dark text-center uraMission">
                        <tbody>
                        <tr>
                            <th colspan="5" class="tab-cells-name">
                                <span data-toggle="tooltip" data-placement="top" title="{{ 'tooltip.uranium'|trans }}">{{ 'zombie.uranium'|trans }} <span class="glyphicon glyphicon-question-sign text-orange"></span></span>
                            </th>
                        </tr>
                        <tr>
                            <th class="tab-cells-name">
                                {{ 'zombie.soldier'|trans }}
                            </th>
                            <th class="tab-cells-name">
                                {{ 'zombie.tank'|trans }}
                            </th>
                            <th class="tab-cells-name">
                                {{ 'zombie.time'|trans }}
                            </th>
                            <th width="55" class="tab-cells-name">
                                {{ 'zombie.gain'|trans }}
                            </th>
                            <th class="tab-cells-name">
                                {{ 'zombie.succed'|trans }}
                            </th>
                        </tr>
                        <tr>
                            <td class="center-cells">
                                {{ form_widget(form_missionUranium.soldier,{attr: { max: planet.getSoldier()}}) }}
                            </td>
                            <td class="center-cells">
                                {{ form_widget(form_missionUranium.tank,{attr: { max: planet.getTank()}}) }}
                            </td>
                            <td class="center-cells">
                                {{ form_widget(form_missionUranium.time) }}
                            </td>
                            <td class="center-cells text-center">
                                <span class="uraniumGain">0</span> <img width="12" src="{{ asset('img/uranium.png') }}">
                            </td>
                            <td class="center-cells text-center">
                                <span class="uraniumPercent">0%</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    {{ form_widget(form_missionUranium.sendForm) }}
                    {{ form_end(form_missionUranium) }}
                </div>
            </div>
            {% if planet.getMissions()|length > 0 %}
                <table class="table table-striped table-bordered table-dark text-center mt-5">
                    <tbody>
                    <tr>
                        <th colspan="6" class="tab-cells-name">
                            Missions en cours
                        </th>
                    </tr>
                    <tr>
                        <th class="tab-cells-name">
                            {{ 'zombie.soldier'|trans }}
                        </th>
                        <th class="tab-cells-name">
                            {{ 'zombie.tank'|trans }}
                        </th>
                        <th class="tab-cells-name">
                            {{ 'zombie.gain'|trans }}
                        </th>
                        <th width="55" class="tab-cells-name">
                            {{ 'zombie.type'|trans }}
                        </th>
                        <th class="tab-cells-name">
                            {{ 'zombie.succed'|trans }}
                        </th>
                        <th class="tab-cells-name">
                            {{ 'zombie.time'|trans }}
                        </th>
                    </tr>
                    {% for mission in planet.getMissions() %}
                        <tr>
                            <td class="center-cells">
                                {{ mission.getSoldier() }} <img width="7" src="{{ asset('img/soldier.png') }}">
                            </td>
                            <td class="center-cells">
                                {{ mission.getTank() }} <img width="18" src="{{ asset('img/tanks.png') }}">
                            </td>
                            <td class="center-cells">
                                {% if mission.getType() == 1 %}<span class="text-vert">+{{ mission.getGain() }}</span> <img width="12" src="{{ asset('img/uranium.png') }}">{% else %}<span class="text-vert">-{{ mission.getGain() }}</span> <img width="12" src="{{ asset('img/zombie_indic.gif') }}">{% endif %}
                            </td>
                            <td class="center-cells text-center">
                                {% if mission.getType() == 1 %}{{ 'zombie.uranium'|trans }}{% else %}{{ 'zombie.zombie'|trans }}{% endif %}
                            </td>
                            <td class="center-cells text-center">
                                {{ mission.getPercent() }}%
                            </td>
                            <td class="center-cells text-center p-1">
                                {% if mission.getMissionAt() > "now"|date("m/d/Y") %}<div><span class="timerArea" hidden>{{ mission.getMissionAt()|date('Y/m/d H:i:s') }}</span></div>{% else %}<a class="badge badge-success p-2" href="{{ path('mission_finish', {'mission': mission.getId(), 'usePlanet': usePlanet.getId()}) }}">{{ 'zombie.finish'|trans }}</span></a>{% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        </div>
    </div>
{% endblock %}
